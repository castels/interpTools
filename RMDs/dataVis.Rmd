---
title: "dataVis"
author: "Sophie Castel"
date: "7/18/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(plotly)
```

# ORIGINAL DATA Xt
```{r}
new.simData <- load_obj("/home/sophie/sophTools/files/new_1/new.simData.rda")
class(new.simData) <- "simList"

p1 <- plotXt(1, simData = new.simData, cptwise = F, axisLabels = F)
p2 <- plotXt(2, simData = new.simData, cptwise = F, axisLabels = F)
p3 <- plotXt(3, simData = new.simData, cptwise = F, axisLabels = F)
p4 <- plotXt(4, simData = new.simData, cptwise = F, axisLabels = F)
p5 <- plotXt(5, simData = new.simData, cptwise = F, axisLabels = F)

setwd("/home/sophie/sophTools/files/new_1")
png("dataXt5.png", width = 1080, height = 1200)
grid.arrange(arrangeGrob(p1,p2,p3,p4,ncol = 2, nrow = 3), arrangeGrob(p5, nrow = 1, ncol = 1), heights = c(2,1),
             bottom = textGrob("time"), left = textGrob("value", rot = 90))
dev.off()
```

# MEAN COMPONENT Mt
```{r}
new.simData <- load_obj("/home/sophie/sophTools/files/new_1/new.simData.rda")
class(new.simData) <- "simList"

setwd("/home/sophie/sophTools/files/new_1")
png("dataMt.png", width = 1080, height = 400)
plotXt(1, simData = new.simData, cptwise = T, axisLabels = T, return = "Mt")
dev.off
```

# FREQUENCY DISTRIBUTION of Tt
```{r}
plotTt_freq <- function(i, simData){
  
  bandwidth = simData$Tt_bandwidth[[i]]
  
    if(is.null(simData$Tt_bandwidth[[i]])){
    bw = "unspecified"
  }
  
  else if(!(is.null(simData$Tt_bandwidth[[i]]))){
    bw = eval(substitute(paste(10^-bandwidth), list(bandwidth = simData$Tt_bandwidth[[i]])))
  }
  
  p <- ggplot() + 
    
    geom_point(aes(x = simData$Tt_freq[[i]], y = rep(0,length(simData$Tt_freq[[i]]))), size = 0.4) + 
    geom_vline(xintercept = simData$Tt_freq[[i]], lwd = 0.05) + 
    ggtitle(bquote(d==.(i)*","~psi == .(length(simData$Tt_freq[[i]]))*","~'bandwidth' == .(bw))) +
    
    xlim(0,0.5) + 
    ylim(0,0) + 
    theme_light()+
    
    theme(axis.text.y = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          axis.ticks.y = element_blank(),
          plot.margin = unit(c(0,0.2,0,0.2),"cm")) +
    
    coord_fixed(ratio = 0.4)
  
  return(p)
}


ppTtFreq1 <- plotTt_freq(1, simData = new.simData) + theme(axis.title.y = element_blank(),
                                                           axis.title.x = element_blank(),
                                         plot.title = element_text(hjust = 0),
                                         text=element_text(size=12))

ppTtFreq2 <- plotTt_freq(2, simData = new.simData) + theme(axis.title.y = element_blank(),
                                                           axis.title.x = element_blank(),
                                         plot.title = element_text(hjust = 0),
                                         text=element_text(size=12))
                                                                            
ppTtFreq3 <- plotTt_freq(3, simData = new.simData) + theme(axis.title.y = element_blank(),
                                                           axis.title.x = element_blank(),
                                         plot.title = element_text(hjust = 0),
                                         text=element_text(size=12))
                                                                            
ppTtFreq4 <- plotTt_freq(4, simData = new.simData) + theme(axis.title.y = element_blank(),
                                                           axis.title.x = element_blank(),
                                         plot.title = element_text(hjust = 0),
                                         text=element_text(size=12))
                                                                            
ppTtFreq5 <- plotTt_freq(5, simData = new.simData) + theme(axis.title.y = element_blank(),
                                                           axis.title.x = element_blank(),
                                         plot.title = element_text(hjust = 0),
                                         text=element_text(size=12))

setwd("/home/sophie/sophTools/files/new_1")
png("dataTt_Freq.png", width = 1000, height = 1100)
grid.arrange(ppTtFreq1,ppTtFreq2,ppTtFreq3,ppTtFreq4,ppTtFreq5, nrow = 5, heights = c(1,1,1,1,1),
             bottom = textGrob(bquote(f == omega/(2*pi)), hjust = 0.45))
dev.off()

```

# Showing the Distribution (Skewness) for Each Criterion
Skewness measures the relative size of the two tails. We determine the best representative statistic (mean or median) for each criterion by looking at the distribution of the skewness measures across all simulations.  Distributions of skewness values with a mean roughly centered at zero indicate that on average the criterion has a reliably symmetric distribution, and the mean will be used as the best measure.  Distributions of skewness values with a mean not in the neighbourhood of zero indicate that on average the criterion has a skewed distribution, and the median will be used as the best measure.

Collect and visualize the distribution of the skewness values for each criterion across all simulations: 

```{r}
new.ag <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")

crit <- rownames(new.ag[[1]][[1]][[1]][[1]])
#crit <- crit[-(which(crit == "TMAPE"))]

setwd("/home/sophie/sophTools/files/new_1")
png("critSkew.png", height = 1000, width = 800)
plotSkew(agEval = new.ag, cptwise = T, symmetric = NULL, crit = crit, output = "plots")
dev.off()

```

Now let's see the corresponding performance metrics across all methods. Coloured bar indicates the "best":
```{r}
pm1 <- plotMetrics(agEval=new.ag, p = c(3), g=c(1), d=1, crit = c("MAPE"))
pm2 <- plotMetrics(agEval=new.ag, p = c(4), g=c(2), d=1, crit = c("MAPE"))
pm3 <- plotMetrics(agEval=new.ag, p = c(5), g=c(3), d=1, crit = c("MAPE"))
pm4 <- plotMetrics(agEval=new.ag, p = c(6), g=c(4), d=1, crit = c("MAPE"))
pm5 <- plotMetrics(agEval=new.ag, p = c(5), g=c(1), d=1, crit = c("MAPE"))
pm6 <- plotMetrics(agEval=new.ag, p = c(6), g=c(1), d=1, crit = c("MAPE"))

grid.arrange(pm1,pm2,pm3,pm4,pm5,pm6)
```

# SURFACE PLOTS
## LAYER_TYPE = METHOD
```{r}
# WITH SPLINES
new.ag <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")
colors = c("#EAECEE","#D5D8DC","#ABB2B9","#808B96","#566573","#2C3E50")

multiSurface(crit="NRMSD", agEval = new.ag, layer_type = "method", m = c("HWI","KAF","EWMA","FMM", "HCS", "NCS"), f="median", highlight = "HWI", highlight_color = "#F92111", colors = colors, d = 1:5)
```

```{r}
# SHOWING AN EXAMPLE OF HOW BAD SPLINES ARE
new.ag <-load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")
colors = c("#EAECEE","#D5D8DC","#ABB2B9","#808B96","#566573","#2C3E50")

# NRMSD
plotSurface(crit="NRMSD", agEval = new.ag, layer_type = "method", m = c("HWI","KAF","EWMA","FMM", "HCS", "NCS"), f="median", highlight = "HWI", highlight_color = "#F92111", colors = colors, d = 1)

#MdAPE
plotSurface(crit="MdAPE", agEval = new.ag, layer_type = "method", m = c("HWI","KAF","EWMA","FMM", "HCS", "NCS"), f="median", highlight = "HWI", highlight_color = "#F92111", colors = colors, d = 1)

```

```{r}
# WITHOUT SPLINES (DEFAULT)
new.ag <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")
colors = c("#EAECEE","#D5D8DC","#ABB2B9","#808B96","#566573","#2C3E50")

multiSurface(crit="NRMSD", agEval = new.ag, layer_type = "method", m = c("HWI","KAF","EWMA"), f="median", highlight = "HWI", highlight_color = "#F92111", colors = colors, d = 1:5)
```

## LAYER_TYPE = DATASET
```{r}
# WITH SPLINES
new.ag <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")
colors = c("#EAECEE","#D5D8DC","#ABB2B9","#808B96","#566573","#2C3E50")

multiSurface(crit="NRMSD", agEval = new.ag, layer_type = "dataset", m = c("HWI","KAF","EWMA","FMM", "HCS", "NCS"), f="median", highlight = 1, highlight_color = "#F92111", colors = colors, d = 1:5)
```

```{r}
# WITHOUT SPLINES (DEFAULT)
new.ag <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")
colors = c("#EAECEE","#D5D8DC","#ABB2B9","#808B96","#566573","#2C3E50")

multiSurface(crit="NRMSD", agEval = new.ag, layer_type = "dataset", m = c("HWI","KAF","EWMA"), f="median", highlight = 1, highlight_color = "#F92111", colors = colors, d = 1:5)
```

# HEATMAPS
```{r}
new.ag <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")
crit = "NRMSD"
colors = c("#F9E0AA","#F7C65B","#FAAF08","#FA812F","#FA4032","#F92111")

setwd("/home/sophie/sophTools/files/new_1")

png(paste0(crit,"_heatmap_m.png"), width = 1000, height = 1000)
multiHeatmap(crit = crit, by = "method", m = c("HWI","KAF","EWMA"), agEval = new.ag, colors = colors)
dev.off()
```

# CROSS SECTIONS
## P
```{r}
agEval <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")

crit = "NRMSD"
d = 1:5
m = c("HWI","KAF","EWMA")
highlight = "HWI"
layer_type = "method"
cross_section = "p"
f = "median"
colors = c("#EAECEE","#D5D8DC","#ABB2B9","#808B96","#566573","#2C3E50")

setwd("/home/sophie/sophTools/files/new_1")
png(paste0(crit,"CSbyMethod_p.png"), width = 1000, height = 1100)
multiCS(agEval = agEval, crit = crit, d = d, m = m, highlight = highlight, layer_type = layer_type, cross_section = cross_section, f = f, colors = colors)
dev.off()
```

```{r}
# Uncollapse
setwd("/home/sophie/sophTools/files/new_1")
png(paste0("D1",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=1, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D2",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=2, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D3",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=3, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D4",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=4, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D5",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=5, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()
```

## G
```{r}
agEval <- load_obj("/home/sophie/sophTools/files/new_1/new.ag.rda")

crit = "NRMSD"
d = 1:5
m = c("HWI","KAF","EWMA")
highlight = "HWI"
layer_type = "method"
cross_section = "g"
f = "median"
colors = c("#EAECEE","#D5D8DC","#ABB2B9","#808B96","#566573","#2C3E50")

setwd("/home/sophie/sophTools/files/new_1")
png(paste0(crit,"CSbyMethod_p.png"), width = 1000, height = 1100)
multiCS(agEval = agEval, crit = crit, d = d, m = m, highlight = highlight, layer_type = layer_type, cross_section = cross_section, f = f, colors = colors)
dev.off()

# Uncollapse
setwd("/home/sophie/sophTools/files/new_1")
png(paste0("D1",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=1, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D2",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=2, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D3",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=3, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D4",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=4, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()

png(paste0("D5",crit,"CSunbyMethod_p.png"), width = 1000, height = 1100)
plotCSBars(agEval=agEval, cross_section=cross_section, crit=crit, d=5, m=m, f = f, layer_type = layer_type, 
           highlight_color = highlight_color, colors = colors, highlight = highlight)
dev.off()
```

# HEATMAP (HW BY DATASET, Z)
```{r}
ag.hr <- load_obj("/home/sophie/sophTools/files/highRes/ag.hr.rda")

setwd("/home/sophie/sophTools/files/highRes")
png(paste0(crit,"_Heatmap_hr.png"), width = 1136, height = 328)
heatmapGrid2(agEval = ag.hr, m = "HWI", f = "median", crit = "NRMSD", d = 1:5)
dev.off()
```


